# 定时器处理非活跃连接

**非活跃连接**：指在网络通信中，建立了连接但暂时没有数据传输的连接状态。

在本项目中，每个连接都绑定了一个**定时器**并设置了一个**过期时间**。对于已经建立的连接，根据其过期时间用升序双向链表组织了起来。若到达定时器设置的时间，则会生成并发送`SIGALRM`信号。信号处理函数利用管道通知主线程，收到该信号后，主线程会对链表上的所有定时器进行处理，即若到达过期时间则会关闭该连接，释放所占用的资源。

## 统一事件源

在本项目中，为了统一信号和其他请求的处理。采用管道来将信号传递给主线程，即信号处理函数往管道的写端写入信号值，主线程从读端读取信号值。为此，管道读端的可读事件也通过`epoll`来进行监听。

> 信号处理函数仅仅发送信号通知程序主循环，将信号对应的处理逻辑放在程序主循环中，由主循环执行信号对应的逻辑代码

## 定时器设计

本项目中的定时器中封装了连接资源、定时事件和过期时间。对于已经建立的连接项目中采用**带头尾结点的升序双向链表**对其进行组织。具体为对定时器按超时时间进行排序，执行定时任务时，将到期的定时器从链表中删除。

操作复杂度：

- **插入**定时器：$O(n)$。
- **删除**定时器：$O(1)$。